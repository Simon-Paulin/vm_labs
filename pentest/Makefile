# ===========================================
# Makefile - Pentest Lab
# ===========================================

COMPOSE = docker compose

.PHONY: build up down stop restart logs ps clean \
		kali-base kali-recon kali-exploit kali-web \
		kali-postex kali-cracking kali-network kali-misc \
		metasploitable2 dvwa juice bwapp mutillidae

# ===========================================
# Global
# ===========================================
build:
	$(COMPOSE) build
build-base:
	$(COMPOSE) build base

up:
	$(COMPOSE) up -d

stop:
	$(COMPOSE) stop

down:
	$(COMPOSE) down

restart: stop up

logs:
	$(COMPOSE) logs -f

ps:
	$(COMPOSE) ps

clean:
	$(COMPOSE) down -v --rmi all --remove-orphans

# ===========================================
# Helper pour shell interactif
# ===========================================
define SHELL_TARGET
	$(COMPOSE) up -d $(1)
	docker exec -it $$(docker ps -qf "name=^/$(2)$$") /bin/bash
endef

# ===========================================
# Containers Kali
# ===========================================
kali-base:
	$(call SHELL_TARGET,base,kali-base)

kali-recon:
	$(call SHELL_TARGET,recon,kali-recon)

kali-exploit:
	$(call SHELL_TARGET,exploit,kali-exploit)

kali-web:
	$(call SHELL_TARGET,web,kali-web)

kali-postex:
	$(call SHELL_TARGET,postex,kali-postex)

kali-cracking:
	$(call SHELL_TARGET,cracking,kali-cracking)

kali-network:
	$(call SHELL_TARGET,network,kali-network)

kali-misc:
	$(call SHELL_TARGET,misc,kali-misc)

# ===========================================
# Cibles vuln√©rables
# ===========================================
metasploitable2:
	$(call SHELL_TARGET,metasploitable2,metasploitable2)

dvwa:
	$(call SHELL_TARGET,dvwa,dvwa)

juice:
	$(call SHELL_TARGET,juice,juice)

bwapp:
	$(call SHELL_TARGET,bwapp,bwapp)

mutillidae:
	$(call SHELL_TARGET,mutillidae,mutillidae)

# ===========================================
# NETWORK
# ===========================================

network:
	docker network inspect pentest_labnet